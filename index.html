<!DOCTYPE html>
<html>
<head>
    <title>IP Checker</title>

    <style>
        body{
            font-family: Arial, sans-serif;
            max-width: 500px;
            margin: auto;
            padding: 20px;
            background:#f2f2f2;
        }

        .box{
            background:white;
            padding:25px;
            border-radius:10px;
            text-align:center;
            box-shadow:0 4px 12px rgba(0,0,0,0.1);
        }

        h2{
            margin-bottom:20px;
        }

        .ip{
            font-size:30px;
            font-weight:bold;
            margin:20px 0;
            background:#f8f9fa;
            padding:15px;
            border-radius:8px;
        }

        button{
            padding:12px 20px;
            font-size:16px;
            background:#4285f4;
            color:white;
            border:none;
            border-radius:6px;
            cursor:pointer;
            width:100%;
        }

        button:disabled{
            background:#ccc;
        }

        .status{
            margin-top:15px;
            font-weight:bold;
            font-size:18px;
        }
    </style>
</head>

<body>

<div class="box">

    <h2>üîç IP Checker</h2>

    <div id="ip" class="ip">Loading...</div>

    <button onclick="checkIP()" id="btn">
        Check & Save IP
    </button>

    <div id="status" class="status"></div>

</div>


<script>

/* ===============================
   YOUR APPS SCRIPT URL (ALREADY SET)
=============================== */
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbwuRU0fdhYmpQ25NI2Qyn9-tX2OjOs8NvbL4_L8UrlyY5RTXeLanGvbAJx6jsATzMixAA/exec";

let currentIP = "";


/* ===============================
   Get IP automatically on load
=============================== */
window.onload = async () => {
    try {
        const r = await fetch("https://api.ipify.org?format=json");
        const d = await r.json();

        currentIP = d.ip;
        document.getElementById("ip").innerText = currentIP;
    } catch {
        document.getElementById("ip").innerText = "Failed";
    }
};


/* ===============================
   Main button function
=============================== */
async function checkIP(){

    const status = document.getElementById("status");
    const btn = document.getElementById("btn");

    btn.disabled = true;
    status.innerText = "Checking...";

    try{

        /* Check duplicate */
        let res = await fetch(SCRIPT_URL,{
            method:"POST",
            body: JSON.stringify({
                action:"checkIP",
                ip: currentIP
            })
        });

        let data = await res.json();

        if(data.exists){
            status.innerText = "‚ùå Duplicate IP";
            btn.disabled = false;
            return;
        }

        /* Get location */
        const locRes = await fetch(`https://ipapi.co/${currentIP}/json/`);
        const loc = await locRes.json();

        /* Save to sheet */
        await fetch(SCRIPT_URL,{
            method:"POST",
            body: JSON.stringify({
                action:"addIP",
                ip: currentIP,
                city: loc.city,
                region: loc.region,
                country: loc.country_name,
                isp: loc.org
            })
        });

        status.innerText = "‚úÖ Unique IP Saved";

    }
    catch(e){
        console.log(e);
        status.innerText = "‚ö†Ô∏è Error";
    }

    btn.disabled = false;
}

</script>

</body>
</html>
