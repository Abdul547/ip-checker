<!DOCTYPE html>
<html>
<head>
    <title>IP Checker</title>

    <style>
        body{
            font-family: Arial;
            max-width:500px;
            margin:auto;
            padding:20px;
            background:#f2f2f2;
        }

        .box{
            background:white;
            padding:25px;
            border-radius:10px;
            text-align:center;
            box-shadow:0 4px 12px rgba(0,0,0,.1);
        }

        .ip{
            font-size:28px;
            font-weight:bold;
            margin:20px 0;
        }

        button{
            padding:12px;
            width:100%;
            background:#4285f4;
            color:white;
            border:none;
            border-radius:6px;
            font-size:16px;
            cursor:pointer;
        }

        .status{
            margin-top:15px;
            font-weight:bold;
            font-size:18px;
        }
    </style>
</head>

<body>

<div class="box">
    <h2>üîç IP Checker</h2>

    <div id="ip" class="ip">Loading...</div>

    <button onclick="checkIP()" id="btn">
        Check & Save IP
    </button>

    <div id="status" class="status"></div>
</div>

<script>

/* YOUR WORKING SCRIPT URL */
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbwuRU0fdhYmpQ25NI2Qyn9-tX2OjOs8NvbL4_L8UrlyY5RTXeLanGvbAJx6jsATzMixAA/exec";

let currentIP = "";


/* Get IP (this API allows CORS, safe) */
window.onload = async () => {
    const r = await fetch("https://api.ipify.org?format=json");
    const d = await r.json();
    currentIP = d.ip;
    document.getElementById("ip").innerText = currentIP;
};


/* Main function */
async function checkIP(){

    const status = document.getElementById("status");
    const btn = document.getElementById("btn");

    btn.disabled = true;
    status.innerText = "Checking...";

    try{

        /* Check duplicate */
        let res = await fetch(SCRIPT_URL,{
            method:"POST",
            body: JSON.stringify({
                action:"checkIP",
                ip: currentIP
            })
        });

        let data = await res.json();

        if(data.exists){
            status.innerText = "‚ùå Duplicate IP";
            btn.disabled = false;
            return;
        }

        /* Save only IP (no CORS problems now) */
        await fetch(SCRIPT_URL,{
            method:"POST",
            body: JSON.stringify({
                action:"addIP",
                ip: currentIP,
                city: "",
                region: "",
                country: "",
                isp: ""
            })
        });

        status.innerText = "‚úÖ Unique IP Saved";

    }
    catch(e){
        console.log(e);
        status.innerText = "‚ö†Ô∏è Error";
    }

    btn.disabled = false;
}

</script>

</body>
</html>
